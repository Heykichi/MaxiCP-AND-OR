<instance format="XCSP3" type="CSP">
  <variables>
    <array id="x" note="x[k][i][j] is the value at row i and column j in the kth region" size="[4][3][3]"> 1..34 </array>
    <array id="y" note="y[k] is the almost magic value of the kth region" size="[4]"> 0..104 </array>
    <array id="aux_gb" note="aux_gb[i] is the ith auxiliary variable having been automatically introduced" size="[32]"> 1..105 </array>
  </variables>
  <constraints>
    <allDifferent note="ensuring different values"> x[0][0][] x[0][1][] x[0][2][] x[1][0][1..2] x[1][1][1..2] x[1][2][2] x[2][0..1][0] x[2][1][1] x[2][2][0..1] x[3][0][] x[3][1][] x[3][2][] </allDifferent>
    <block note="ensuring almost magic regions">
      <group>
        <sum>
          <list> %0 %1 %2 </list>
          <condition> (ge,y[0]) </condition>
        </sum>
        <args> x[0][0][] </args>
        <args> x[0][1][] </args>
        <args> x[0][2][] </args>
        <args> x[0][][0] </args>
        <args> x[0][][1] </args>
        <args> x[0][][2] </args>
        <args> x[0][0][0] x[0][1][1] x[0][2][2] </args>
        <args> x[0][2][0] x[0][1][1] x[0][0][2] </args>
      </group>
      <group>
        <sum>
          <list> %0 %1 %2 </list>
          <condition> (le,%3) </condition>
        </sum>
        <args> x[0][0][] aux_gb[0] </args>
        <args> x[0][1][] aux_gb[1] </args>
        <args> x[0][2][] aux_gb[2] </args>
        <args> x[1][0][] aux_gb[8] </args>
        <args> x[1][1][] aux_gb[9] </args>
        <args> x[1][2][] aux_gb[10] </args>
        <args> x[2][0][] aux_gb[16] </args>
        <args> x[2][1][] aux_gb[17] </args>
        <args> x[2][2][] aux_gb[18] </args>
        <args> x[3][0][] aux_gb[24] </args>
        <args> x[3][1][] aux_gb[25] </args>
        <args> x[3][2][] aux_gb[26] </args>
        <args> x[0][][0] aux_gb[3] </args>
        <args> x[0][][1] aux_gb[4] </args>
        <args> x[0][][2] aux_gb[5] </args>
        <args> x[1][][0] aux_gb[11] </args>
        <args> x[1][][1] aux_gb[12] </args>
        <args> x[1][][2] aux_gb[13] </args>
        <args> x[2][][0] aux_gb[19] </args>
        <args> x[2][][1] aux_gb[20] </args>
        <args> x[2][][2] aux_gb[21] </args>
        <args> x[3][][0] aux_gb[27] </args>
        <args> x[3][][1] aux_gb[28] </args>
        <args> x[3][][2] aux_gb[29] </args>
        <args> x[0][0][0] x[0][1][1] x[0][2][2] aux_gb[6] </args>
        <args> x[1][0][0] x[1][1][1] x[1][2][2] aux_gb[14] </args>
        <args> x[2][0][0] x[2][1][1] x[2][2][2] aux_gb[22] </args>
        <args> x[3][0][0] x[3][1][1] x[3][2][2] aux_gb[30] </args>
        <args> x[0][2][0] x[0][1][1] x[0][0][2] aux_gb[7] </args>
        <args> x[1][2][0] x[1][1][1] x[1][0][2] aux_gb[15] </args>
        <args> x[2][2][0] x[2][1][1] x[2][0][2] aux_gb[23] </args>
        <args> x[3][2][0] x[3][1][1] x[3][0][2] aux_gb[31] </args>
      </group>
      <group>
        <sum>
          <list> %0 %1 %2 </list>
          <condition> (ge,y[1]) </condition>
        </sum>
        <args> x[1][0][] </args>
        <args> x[1][1][] </args>
        <args> x[1][2][] </args>
        <args> x[1][][0] </args>
        <args> x[1][][1] </args>
        <args> x[1][][2] </args>
        <args> x[1][0][0] x[1][1][1] x[1][2][2] </args>
        <args> x[1][2][0] x[1][1][1] x[1][0][2] </args>
      </group>
      <group>
        <sum>
          <list> %0 %1 %2 </list>
          <condition> (ge,y[2]) </condition>
        </sum>
        <args> x[2][0][] </args>
        <args> x[2][1][] </args>
        <args> x[2][2][] </args>
        <args> x[2][][0] </args>
        <args> x[2][][1] </args>
        <args> x[2][][2] </args>
        <args> x[2][0][0] x[2][1][1] x[2][2][2] </args>
        <args> x[2][2][0] x[2][1][1] x[2][0][2] </args>
      </group>
      <group>
        <sum>
          <list> %0 %1 %2 </list>
          <condition> (ge,y[3]) </condition>
        </sum>
        <args> x[3][0][] </args>
        <args> x[3][1][] </args>
        <args> x[3][2][] </args>
        <args> x[3][][0] </args>
        <args> x[3][][1] </args>
        <args> x[3][][2] </args>
        <args> x[3][0][0] x[3][1][1] x[3][2][2] </args>
        <args> x[3][2][0] x[3][1][1] x[3][0][2] </args>
      </group>
    </block>
    <group note="dealing with overlapping cells">
      <intension> eq(%0,%1) </intension>
      <args> x[0][1][2] x[1][0][0] </args>
      <args> x[0][2][2] x[1][1][0] </args>
      <args> x[0][2][0] x[2][0][1] </args>
      <args> x[0][2][1] x[2][0][2] </args>
      <args> x[1][2][0] x[3][0][1] </args>
      <args> x[1][2][1] x[3][0][2] </args>
      <args> x[2][1][2] x[3][0][0] </args>
      <args> x[2][2][2] x[3][1][0] </args>
    </group>
    <group>
      <intension> eq(add(%0,1),%1) </intension>
      <args> y[0] aux_gb[0] </args>
      <args> y[0] aux_gb[1] </args>
      <args> y[0] aux_gb[2] </args>
      <args> y[0] aux_gb[3] </args>
      <args> y[0] aux_gb[4] </args>
      <args> y[0] aux_gb[5] </args>
      <args> y[0] aux_gb[6] </args>
      <args> y[0] aux_gb[7] </args>
      <args> y[1] aux_gb[8] </args>
      <args> y[1] aux_gb[9] </args>
      <args> y[1] aux_gb[10] </args>
      <args> y[1] aux_gb[11] </args>
      <args> y[1] aux_gb[12] </args>
      <args> y[1] aux_gb[13] </args>
      <args> y[1] aux_gb[14] </args>
      <args> y[1] aux_gb[15] </args>
      <args> y[2] aux_gb[16] </args>
      <args> y[2] aux_gb[17] </args>
      <args> y[2] aux_gb[18] </args>
      <args> y[2] aux_gb[19] </args>
      <args> y[2] aux_gb[20] </args>
      <args> y[2] aux_gb[21] </args>
      <args> y[2] aux_gb[22] </args>
      <args> y[2] aux_gb[23] </args>
      <args> y[3] aux_gb[24] </args>
      <args> y[3] aux_gb[25] </args>
      <args> y[3] aux_gb[26] </args>
      <args> y[3] aux_gb[27] </args>
      <args> y[3] aux_gb[28] </args>
      <args> y[3] aux_gb[29] </args>
      <args> y[3] aux_gb[30] </args>
      <args> y[3] aux_gb[31] </args>
    </group>
  </constraints>
</instance>
